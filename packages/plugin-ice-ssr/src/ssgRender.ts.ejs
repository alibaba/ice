import { pathToRegexp } from 'path-to-regexp';

const parseurl = require('parseurl');

function render(ctx, data) {
  const { req, res } = ctx;
  const { pathname } = parseurl(req);

  const { defaultHtml = '', renderRoutes = [] } = data;

  // check if there are already pre-rendered routes
  const renderRoute = renderRoutes.find(({ path, exact: end = false, strict = false, sensitive = false }) => {
    try {
      const regexp = pathToRegexp(path, [], { end, strict, sensitive });
      return regexp.test(pathname);
    } catch (e) {
      return false;
    }
  });

  if (renderRoute) {
    const { html } = renderRoute;
    return html;
  } else {
    return defaultHtml;
  }

  return defaultHtml;
}

export default render;
