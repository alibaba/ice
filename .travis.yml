sudo: required
language: node_js
node_js:
  - '8'
matrix:
  include:
    - os: linux  
      script:
        - npm run lint:nofix
      deploy:
        provider: script
        skip_cleanup: true # 避免清空已安装的依赖
        script: npm run generate:docs && npm run upload-oss
        on:
          all_branches: true
    - os: osx
      if: branch = iceworks/electron
      script:
        - cd tools/iceworks-app && npm install 
        - sed -i.bak "s/proto === EggCore.prototype/proto.constructor.name === EggCore.name/g" node_modules/egg-core/lib/loader/egg_loader.js # patch eggcore loader
        - cp -r ../../packages/iceworks-server/dist dist
        - cp ../../packages/iceworks-server/package.json dist/
        - export CSC_IDENTITY_AUTO_DISCOVERY=false
        - npm run build