const{BrowserWindow:e,ipcMain:t,dialog:n,shell:o}=require("electron"),{windowURL:r,isMac:i,isWin:a}=require("./shared"),l=require("./createTouchBar"),s=require("./services/sessions"),u=require("./logger");let c=!1,w=!1;function d(o,r){t.on("app-quit-install",()=>{c=!0}),o.on("before-quit",()=>{c=!0,u.info("before-quit on state keeper"),r.isDestroyed()||r.destroy()}),r.on("close",t=>{i?c||(t.preventDefault(),r.hide()):!s.buildProxy.checkRuning()&&!s.startProxy.checkRuning()||w?e.getAllWindows().forEach(e=>{e.destroy()}):(t.preventDefault(),n.showMessageBox({type:"question",title:o.getName(),message:"\u9879\u76ee\u6b63\u5728\u8fd0\u884c\u4e2d",detail:"\u662f\u5426\u7ec8\u6b62\u4efb\u52a1\uff0c\u5e76\u7acb\u5373\u9000\u51fa\uff1f",buttons:["\u53d6\u6d88","\u786e\u5b9a"]},t=>{1===t&&(w=!0,e.getAllWindows().forEach(e=>{e.destroy()}))}))})}exports.createHomeWindow=function(t){const n=new e({title:t.getName(),backgroundColor:"#fefefe",width:a?890:870,height:a?630:600,minWidth:a?890:870,minHeight:a?630:600,resizable:!0,center:!0,show:!0,fullscreenable:!1,transparent:!1,webPreferences:{preload:"on"}}),i=(e,t)=>{t!==n.webContents.getURL()&&(e.preventDefault(),o.openExternal(t))};return n.webContents.on("will-navigate",i),n.webContents.on("new-window",i),n.loadURL(r("index")),d(t,n),n},exports.createUpdaterWindow=(()=>{const t=new e({backgroundColor:"#ECECEC",center:!0,frame:!0,fullscreenable:!1,height:83,width:320,maximizable:!1,minimizable:!1,resizable:!1,show:!1,title:"",webPreferences:{backgroundThrottling:!1}}),n=(e,n)=>{n!==t.webContents.getURL()&&(e.preventDefault(),o.openExternal(n))};return t.webContents.on("will-navigate",n),t.webContents.on("new-window",n),t.setMenu(null),t.loadURL(r("updater")),t}),exports.openAboutWindow=(()=>{const t=new e({width:280,height:200,title:"",resizable:!1,center:!0,show:!0,fullscreenable:!1,maximizable:!1,minimizable:!1,frame:!0,backgroundColor:"#ECECEC",webPreferences:{backgroundThrottling:!1}});t.setMenu(null),t.loadURL(r("about"))}),exports.createTouchBar=l;