---
title: 路由
order: 4
---

框架提供了 **配置式路由** 和 **约定式路由** 两种方案，可根据开发偏好选择合适的路由方案。

框架约定项目 `src/routes.[ts|js]` 文件如果存在，则使用配置式路由，否则使用约定式路由。

## 配置式路由

### 路由协议

路由按照一定的约定进行配置，用来描述路由的结构关系。开发者大多数时候只需要关注路由配置，框架约定路由配置在 `src/config/routes.(ts|js) 文件中。

路由配置协议如下：

```ts
const routerConfig = [
  // 分组路由，children 里的路由会将父节点的 component 作为布局组件
  {
    path: '/user',
    component: UserLayout,
    children: [
      {
        path: '/login',
        component: UserLogin,
      },
      {
        path: '/',
        // 重定向
        redirect: '/user/login',
      },
      {
        // 404 没有匹配到的路由
        component: NotFound,
      },
    ],
  },
  // 非分组路由
  {
    path: '/about',
    component: About,
  },
]
```

注意：路由有一个按顺序匹配的规则，从上到下一旦命中路由匹配规则就会停止遍历，因此如果你在最前面配置了 / 这样一个路由，则所有的路由都会命中该规则，导致其他路由没有效果，所以在开发时要注意路由的顺序以及 exact 属性的使用。

### 路由配置

框架约定配置式路由默认配置在 `src/routes.(ts|js)` 中，如果你需要修改该路径可以 `build.json` 中进行配置:

```json
{
  "router": {
    // ...options
  }
}
```

**options:**

- **configPath**： type `string`, default `src/routes.[ts|js]`

## 约定式路由

框架按照 pages 目录结构自动生成路由配置，也即约定式路由。

### 基础路由

假设 pages 的目录结构如下：

```markdown
src/pages
└── About
    └── index.tsx
└── Dashboard
    ├── a.tsx
    └── b.tsx
```

那么，框架自动生成的路由配置如下：


```ts
export default [
  {
    path: '/dashboard',
    exact: true,
    component: PageDashboard
  },
  {
    path: '/home/a',
    exact: true,
    component: PageHomeA
  },
  {
    path: '/home/b',
    exact: true,
    component: PageHomeB
  }
]
```

### 嵌套路由

框架约定页面目录下存在名为 `_layout.[jsx|tsx]` 时，会产生一个嵌套路由，当前目录和子目录均为子路由。

假设 pages 的目录结构如下：

```markdown
src/pages
└── About
    ├── _layout.tsx
    ├── a.tsx
    └── b.tsx
└── Dashboard
    └── index.tsx
```

那么，框架自动生成的路由配置如下：

```js
export default [
  {
    path: '/about',
    exact: false,
    component: LayoutAbout,
    children: [
      {
        path: '/a',
        exact: true,
        component: PageAboutA
      },
      {
        path: '/b',
        exact: true,
        component: PageAboutB
      },
    ],
  },
  {
    path: '/dashboard',
    exact: true,
    component: PageDashboard
  }
]
```

### 动态路由

框架约定定义带参数的动态路由，需要创建对应的以下划线作为前缀的文件或目录。

- 路径中 `$` 作为文件夹或文件名的首个字符，标识一个动态路由，如 `src/pages/app/$uid.tsx` 会生成路由 `/app/:uid`
- 路径中文件夹或文件名的首个和最后一个字符同时为 `$`，标识一个可选的动态路由，如 `src/pages/app/$uid$.tsx` 会生成路由 `/app/:uid?`

假设 pages 的目录结构如下：

```markdown
src/pages
└── repo
    ├── $pid.tsx
    └── index.tsx
└── $uid$.tsx
```

那么，框架自动生成的路由配置如下：

```js
export default [
  {
    path: '/repo/:pid',
    exact: true,
    component: PageRepo$pid
  },
  {
    path: '/repo',
    exact: true,
    component: PageRepo
  },
  {
    path: '/:uid?',
    exact: true,
    component: Page$uid$
  }
]
```

### 全局 Layout

如果 `src/layouts/index.[jsx|tsx]` 文件存在，则将它默认作为全局 layout

### 404 路由

如果 `src/pages/404.[jsx|tsx]` 或者 `src/pages/404/index.[jsx|tsx]` 文件存在，则将它作为 404 页面

### 路由配置

#### 运行时配置

在 `src/app.ts` 中，我们可以配置路由的类型和基础路径等路由信息，具体配置如下：

```js
import { createApp } from 'ice'

const appConfig = {
  router: {
    type: 'browser',
    basename: '/seller',
    modifyRoutes: (routes) => {
      return routes;
    }
  }
};

createApp(appConfig);
```

#### 构建配置:

在 `build.json` 中，我们可以配置相关目录不进行自动路由的生成，具体配置如下：

```json
{
  "router": {
    "ignorePaths": ["stores", "components"]
  }
}
```

**options**:

- **caseSensitive**：type `boolean`, default value `false`, route path generated by plugin will be case sensitive according to project directory
- **ignoreRoutes**：type `string[]`, default value `[]`, routes 
 configurated will not be generated
- **ignorePaths**：type `string[]`, default value `['components']`, ignore every path include `components` dir
